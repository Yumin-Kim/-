# Dockerfile 정리

생성일: 2021년 9월 18일 오후 9:14

간단하게 Spring 공식 사이트에서 소개하는 도커를 통해서 docker를 통해 환경 구축

```docker
FROM adoptopenjdk/openjdk11
ARG JAR_FILE=target/*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

```bash
docker build -t dbals0/docker_demo_start .
docker run -it -p 8080:8080 dbals0/docker_demo_start
```

상단의 도커 명령어를 실행하게 되면 -t옵션에 해당하는 이름으로 이미지가 생성하게 된다.

## 기초 명령어

```docker
#Dockerfile에 대한 간략한 설명
#FROM 베이스 이미지를 지정한다. 반드시 지정해야한다.
#FROM <image>/<tag>
FROM ubuntu/18.04

#MAINTAINER
#Dockerfile을 관리하는 사람의 이름이나 이메일 정보를 기록하는곳
MAINTAINER dbals0@naver.com

#COPY 
# 파일이나 디렉토리를 이미지로 복사한다.

#WORKDiR
#WORKDIR 명령문은 shell의 cd명령문처럼 컨테이너상에서 작업 디렉토리로 전환을 위해서 사용하다. 
# 전환하게 되면 전환된 디렉토리에서 RUN ,CMD ,ENTRYPOINT , COPY , ADD 명령문을 해당 디렉토리를 기준으로 실행한다.
WORKDIR /usr/share/tomcat9

# RUN 명령문은 마치 쉘에서 커냄드를 실행하는것 처럼 이미지 빌드 과정에서 필요한 커맨드를 실행하기 위해서 사용
# 보통 소프트웨어 설치를 위해 사용한다.
RUN pip install -r requirements.txt

# ENTRYPOINT 명령문은 이미지를 컨테이너로 띄울때 항상 실행되어야한는 커맨드를 지정할 때 사용
# Docker이미지를 마치 하나의 실행 파일처럼 사용할때 유용하며 지정된 커맨드가 실행되고 이 커맨드로 실행된 프로세스가 죽을때, 컨테이너도 따라 죽게된다.
ENTRYPOINT ["npm","start"]

#CMD 명령문은 해당 이미지를 컨테이너로 띄울때 디폴트로 실행할 커맨드나 ENTRYPOINT 명령문으로 지정된 커맨드에 디폴트로 넘길때 파라미터를 지정
# CMD 명령문은 많은 경우 ENTRYPOINT 명령문과 함께 사용하게 되는데 ENTRYPOINT를 커맨드로 지정하고 CMD 명령문으로 디폴트 파라미터를 지정해주면 매우 유연하게 동작할 수 있게 된다.
# RUN과 혼돈할 수 있지만 Dockerfile에 여러 RUN 명령문을 선언할 수 있지만 CMD는 컨테이너 뛰울때 단 한번 밖에 사용하지 못한다.
# 또한 docker run 당시 인자를 넘길 경우 기능을 상실하게 된다. 
CMD ["<커맨드>","<파라미터1>","<파라미터2>"]
CMD ["<파라미터1>","<파라미터2>"]
CMD <전체 커맨드>

#EXPOSE 명령문은 네트워크 상에서 컨테이너로 들오오는 트래픽을 리스팅하는 포트와 프로토콜을 지정하기 위해서 사용하다
# 호스트 컴퓨터로 부터 접근을 허용하기 위해서는 docker run 커맨드를 -p 옵션을 추가하여 ghtmxm
```

## 다른 포스팅 보고 다시 한번더 정리

```docker
#Dockerfile에 대한 간략한 설명
#FROM 베이스 이미지를 지정한다. 반드시 지정해야한다.
#FROM <image>/<tag>
FROM ubuntu/18.04

#MAINTAINER
#Dockerfile을 관리하는 사람의 이름이나 이메일 정보를 기록하는곳
MAINTAINER dbals0@naver.com

#COPY 
# 파일이나 디렉토리를 이미지로 복사한다.

#WORKDiR
#WORKDIR 명령문은 shell의 cd명령문처럼 컨테이너상에서 작업 디렉토리로 전환을 위해서 사용하다. 
# 전환하게 되면 전환된 디렉토리에서 RUN ,CMD ,ENTRYPOINT , COPY , ADD 명령문을 해당 디렉토리를 기준으로 실행한다.
WORKDIR /usr/share/tomcat9

# RUN
# RUN 명령문은 마치 쉘에서 커냄드를 실행하는것 처럼 이미지 빌드 과정에서 필요한 커맨드를 실행하기 위해서 사용
# 보통 소프트웨어 설치를 위해 사용한다.
RUN pip install -r requirements.txt

#ENTRYPOINT
# ENTRYPOINT 명령문은 이미지를 컨테이너로 띄울때 항상 실행되어야한는 커맨드를 지정할 때 사용
# Docker이미지를 마치 하나의 실행 파일처럼 사용할때 유용하며 지정된 커맨드가 실행되고 이 커맨드로 실행된 프로세스가 죽을때, 컨테이너도 따라 죽게된다.
ENTRYPOINT ["npm","start"]

#CMD
#CMD 명령문은 해당 이미지를 컨테이너로 띄울때 디폴트로 실행할 커맨드나 ENTRYPOINT 명령문으로 지정된 커맨드에 디폴트로 넘길때 파라미터를 지정
# CMD 명령문은 많은 경우 ENTRYPOINT 명령문과 함께 사용하게 되는데 ENTRYPOINT를 커맨드로 지정하고 CMD 명령문으로 디폴트 파라미터를 지정해주면 매우 유연하게 동작할 수 있게 된다.
# RUN과 혼돈할 수 있지만 Dockerfile에 여러 RUN 명령문을 선언할 수 있지만 CMD는 컨테이너 뛰울때 단 한번 밖에 사용하지 못한다.
# 또한 docker run 당시 인자를 넘길 경우 기능을 상실하게 된다. 
CMD ["<커맨드>","<파라미터1>","<파라미터2>"]
CMD ["<파라미터1>","<파라미터2>"]
CMD <전체 커맨드>

#EXPOSE
#EXPOSE 명령문은 네트워크 상에서 컨테이너로 들오오는 트래픽을 리스팅하는 포트와 프로토콜을 지정하기 위해서 사용하다
# 호스트 컴퓨터로 부터 접근을 허용하기 위해서는 docker run 커맨드를 -p 옵션을 추가하여 호스트 컴퓨터의 특정 포트를 포트 포워딩 해주어야한다.
EXPOSE 80

#VOLUME
# 빌드된 이미지로 컨테이너가 생성될때 호스트와 공유할 컨테이너 디렉토리 설정
VOLUME /Web/path

# COPY/ADD
# COPY 명령문은 호스트 컴퓨터에 있는 디렉토리나 파일을 Docker 이미지 파일 시스셑으로 복사하기 위해서 사용
# 절대와 상대 경로 모두 지원
# 상대 경로 사용시 WORKDIR을 확인이 필요하다
# ADD 사용시 특수한 파일 또한 가능하다.
COPY package.json package.json

#ENV
# ENV명령문은 환경 변수를 설정할 수 있다.
# ENV <이름>=<값>
# ENV <이름> <값>
ENV NODE_ENV production

# ARG
# ARG 명령문은 docker build 커맨드로 이미지를 빌드시 --build-arg 옵션을 통해 넘길 수 있는 인자을 정의하기 윟 사용된다.
ARG port
# $docker build --build-arg port 8000
# ${인자 명}형태로 읽어서 사용 할 수 있다.
CMD start.sh -h 127.0.0.1 -p ${port}

```