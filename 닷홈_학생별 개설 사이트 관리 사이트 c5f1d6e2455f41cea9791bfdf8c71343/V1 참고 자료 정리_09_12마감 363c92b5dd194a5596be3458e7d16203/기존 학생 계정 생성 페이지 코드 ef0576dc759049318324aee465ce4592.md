# 기존 학생 계정 생성 페이지 코드

생성일: 2021년 8월 21일 오후 5:59

```php
<?php
set_include_path(get_include_path() . PATH_SEPARATOR . 'phpseclib');
include('Net/SSH2.php');

try{
        $key=$_POST["key"];
        $student_id=$_POST["student_id"];
        $fullname =$_POST["fullname"];
        $student_passwd =$_POST["password"];
        $phone =$_POST["phone"];
        $email =$_POST["email"];

        $student_id='s'.$student_id;

        if ($key !="class202102")
        {
             echo '{"Operation":"Failed"}';
             return;
        }
        // ToDo: additional checking...

     //1. ssh 로그인한다.
     $ssh = new Net_SSH2('localhost');
     $ssh->login('multiadmin', 'ajfxlaleldj');

     //2. user 생성
     $res= $ssh->exec('sudo adduser --disabled-password --gecos "" '.$student_id);
     $ssh->exec('sudo chpasswd <<<"'.$student_id.':'.$student_passwd.'"');

			// 파일 소유권 변경
//chown {소유권자}:{그룹식별자} {소유권을 변경하고 싶은 파일명}
     $ssh->exec('sudo chown root:'.$student_id.' /home/'.$student_id); 
     $ssh->exec('sudo chmod 755 /home/'.$student_id); // ssh 유저 디렉토리 생성_파일 권한 >> [755] 사용자만 접근 가능
     $ssh->exec('sudo mkdir /home/'.$student_id.'/Public');
     $ssh->exec('sudo chown root:'.$student_id.' /home/'.$student_id.'/Public');// 업로드 할 수 있는 디렉토리 생성
     $ssh->exec('sudo usermod -G filetransfer '.$student_id); //ssh 유저 그룹 지정
     $ssh->exec('ln -s /home/'.$student_id.'/Public  /var/www/html/'.$student_id); // 심볼릭 링크 파일 생성 >> 윈도우의 바로가기와 유사한 기능

     //3. mysql 설정
     $connection = mysqli_connect('localhost', 'root', 'multi2021', 'mysql');
     if ($connection -> connect_errno) {
          //echo "Failed to connect to MySQL: " . $connection -> connect_error;
          echo '{"Operation":"Failed"}';
          return;
    }

     ////// select * from login where user_id='$u_id' AND passwd=PASSWORD( '$passwd' ) ";
     $query = "CREATE USER '".$student_id."'@'%' IDENTIFIED BY '".$student_passwd."'";
     //echo $query."<br>";
     mysqli_query($connection, $query);

     $query = "create database ".$student_id;
     //echo $query."\n";
     mysqli_query($connection, $query);

     $query = "grant all privileges on ".$student_id.".* to '".$student_id."'@'%'";
     //echo $query."\n";
     mysqli_query($connection, $query);

     $query = "FLUSH privileges";
     mysqli_query($connection, $query);

     echo '{"Operation":"Sucess"}';
   }
   catch (Exception $e) {
      //echo 'Error Message: ' .$e->getMessage();
      echo '{"Operation":"Failed"}';
   }
?>
```

### addUser.php 상황