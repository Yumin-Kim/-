# V1 _ 전반적인 구현

생성일: 2021년 9월 14일 오전 12:08

개발 순서
1. 아파치 X 톰캣 연동 [X]
2. 화면 설계[X]
3. REST API 설계 [X]
4. 백엔드 개발 [X] >> 테스트 진행 및 api 수정[X]
5. 프론트 개발_ V1[X]
6. release 진행[X]
7. 프론트 개발 V2 UI 수정

**release하기 전 테스트는 docker를 활용하여 진행하고자 한다.**

# 0. 기존 구현 방식

기존 사이트 구성 
현재 학생의 계정 생성 시 DB와 생성된 계정에 따른 디렉토리가 생겨 사이트를 구성하여 호스팅 되도록 PHP 로 구현 되어 있다.

//기존 구현 방식 >> 방식 유지하는 방식으로 개발
SSH 프로토콜을 활용하여  유저 생성 및 디렉토리 , 데이터베이스 생성 되는 구조

//TODO
Spring을 사용하게 된다면 addUser.php가 동작 할 수 있도록 구현하거나 adduser.php에 생성된 정보를 Student table에 저장해야할 필요

# 1. 우분투 환경 apache2 X tomcat9 연동

기존 서버 컴퓨터는 apache2 와 php 를 통해서 동적 컨텐츠를 제공하고 있는 구조이다.
해당 구조를 tomcat를 통해 Spring을 사용하고자 아키텍처 구조를 아래와 같이 구성하였다.
기존 tomcat을 동작 시키게 되면 :8080 를 통해서 apache와 연관 없이 동작하는것을 볼 수 있게 되는데 이런 부분을 수정 하기 위해서 apache에 부가적인 설정을 해주어야한다.
아래 링크와 같이 mod_jk를 사용하게 되면 apache에서 tomcat를 사용할 수 있는 설정이 된다.
하지만 따라했지만 동작하지 않는다.
문제는 mod_jk의 worker.properties가 제대로 동작하지 않는것 같다.

**현재 포트 연결이 안되는 부분은 생략하고 다음 단계로 진행할 예정이다.
계속 해당 부분을 붙잡고 있는것은 시간 낭비!!**

[우분투 - 아파치 톰캣 연동](https://daisyleh.blogspot.com/2020/03/blog-post.html)

화면 설계 전 기존 php 소스코드를 수정하지 않고 진행하려 했으며 개발하는 계정 사이트를 이용하기 보다는 기존에 구성된 사이트를 쓸 여지가 많기 때문에 사용자를 관리 할 수 있는 사이트 먼저 개발하자라는 생각이 들어 아래와 같은 구현을 먼저 알아 보았다.

### [21.08.21] 리버스 프록시 사용하여 포트 포워딩하여  연결하는 방법

[Ubuntu Linux 에서 Apache 설정](https://s2junn.tistory.com/56)

아파치 기본 설정_생각보다 간단하며 꼭 한번 보기

## 서브) Docker 기반 기존 구성된 서버와 유사 구조 구성후 사용자 정보 관리

기존 소스 코드를 분석을 하였고 소스코드는 ssh를 명령어를 통해 사용자를 생성 및 php의 시스템 콜 호출이 되는것을 활용하여 디렉토리 생성 , Mysql DBS에 mysql을 활용하여 데이터 베이스 생성 및 간단한 설정 하게끔 설정되어 있다. 아래 링크를 통해 데이터 베이스를 생성하는 코드를 볼 수 있을 것이다.

[Mysql 데이터베이스란? 'user'테이블과 'db'테이블?](https://kyoe.tistory.com/54)

[MySQL 계정 생성 관리 및 권한설정](https://2dubbing.tistory.com/13)

[mysql.user 테이블](https://runebook.dev/ko/docs/mariadb/mysqluser-table/index)

기존 apache2 와 php mysql 연동이 되어 있기에 동일한 구조를 docker에 구축하였고 구축하는 부분에서는 큰 어려움 없었지만 디버깅에 큰 불편함을 느끼게 되었고 vim를 사용하는 부분이 조금 불편하였다. sftp를 사용하는 방향으로 개발 진행을 요한다.

진행하며 php로 mysql 접근에 어려움이 있었지만 문제는 mysql 설정에 있어 비밀번호 설정 수준이 높았고 기존 구성한 mysql 비밀번호가 설정 수준에 적합하지 않아 접근을 못하는 경우를 겪게 되었다. 에러 코드는 MySQL error: 'Access denied for user 'root'@'localhost'을 보게 되었고 검색을 통해 비밀번호를 삭제하고 비밀 번호 설정 수준을 낮게 잡게 되어 해결 하게 되었다.

[https://toytvstory.tistory.com/1617](https://toytvstory.tistory.com/1617)
[https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=abc2185&logNo=220294755812](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=abc2185&logNo=220294755812)
[https://junho85.pe.kr/1484](https://junho85.pe.kr/1484)
[https://stackoverflow.com/questions/55237257/mysql-validate-password-policy-unknown-system-variable](https://stackoverflow.com/questions/55237257/mysql-validate-password-policy-unknown-system-variable)

오류 수정 이후 php 코드 작성 부분에서 시간을 소모하였다
기존 코드에서 모듈형식으로 동작하기 위해서 작성한 코드를 외부 파일의 함수 호출하는 방식으로 작성하였지만 아직 에러에 대한 분기처리가 부족하다.

##### 톰캣 빌드 테스트 ##### 

톰캣 빌드

1. windows 환경에서 개발 진행
java는 OS를 구애 받는 언어 이기 때문에 상관 X
2. maven war jar 빌드 방법
[https://hue9010.github.io/spring/springboot-war/](https://hue9010.github.io/spring/springboot-war/)
3. windows tomcat 9.0.52에서 java 11 spring이 빌드가 안되었던 이유
[https://sarc.io/index.php/forum/tips/2715-java-home](https://sarc.io/index.php/forum/tips/2715-java-home)
4. tomcat 로깅 수정
5. jar로 [spring.start.io](http://spring.start.io/) 생성시 serlize하는 코드 생성 필요
[https://browndwarf.tistory.com/67](https://browndwarf.tistory.com/67)
6. 기본 루트 
ROOT.war로 아카이브 진행 [https://its-easy.tistory.com/4](https://its-easy.tistory.com/4) , 

    server.xml

7. 우분투 환경 설정 

    ```powershell
    apt-get install openjdk-11-jdk
    java --version
    wget http://apache.mirror.cdnetworks.com/tomcat/tomcat-9/v9.0.52/bin/apache-tomcat-9.0.52.tar.gz
    tar -zxvf apache-tomcat-9.0.52.tar.gz
    mv apache-tomcat-9.0.52 tomcat9
    ```

8. tomcat 로깅

[[CENTOS]Tomcat 로그보는 방법](https://iamjoso.tistory.com/26)

###### 개발 편의성 ######

docker ssh server 구성 후 SFTP를 통해 파일 업로드를 통해 개발 편의성 상승

```powershell
apt install openssh-server
service --status-all
netstat -nap// 포트 확인
//sftp를 통해 war파일 전송후
mv ROOT.war ~/../usr/share/tomcat9/webapps/ 
```

### Apache & Tomcat 연동

[개발일기 : 네이버 블로그](https://blog.naver.com/tawoo0/221587063882)

- mod_jk란?

    아파치와 톰캣을 연동하기 위한 모듈로써 AJP 프로토콜을 이용하여 아파치에 들어온 요청 중 톰캣이 처리할 요청을 AJP 포트(일반적으로 8009)를 통해 톰캣에 전달하고 그에 대한 응답을 받는 역할 수행

    mod_jk(tomcat connector)를 이용한 방법, mod_proxy를 이용한 방법, mod_proxy_ajp를 이용한 방법 크게 3가지가 있다.

### 2021.08.19 ⇒Docker 환경에서 환경 구축 및 war 파일 배포까지 진행 완료

도커 우분투에 모든것을 하나하나 세팅했지만 1차 프로젝트 진행후 docker compose 배워 다시 진행

---

# 2. 화면 설계

참고 자료 . 이미지 자료 정리 참고 

# 3. REST API 설계

참고 자료 . RESTAPI 참고
추가적으로 php로 구현된 api를 호출해야할 가능성이 있기 때문에 아래 코드를 보고 작성

[Spring Boot - 외부 API Json 방식으로 호출 하기](https://r-0o0-j.tistory.com/132)

# 4. 백엔드 개발

TODO List
1. PHP 소스코드를 통해 생성되는 도메인  , 데이터 베이스 정보 테이블에 저장
  * [21.08.21] 데이터 베이스 변경 여지가 크지 않기 때문에 미정 상태
2. REST API의 DELETE , UPDATE 하는 기능 구현(Spring과 PHP로 코드 작성해야함)
3. docker 테스트 진행
4. 실제 서버와 유사하게 구성 후 배포 진행
5. 사용에 있어 큰문제가 없다면 백엔드 관리자 영역 부터 개발 진행

[부가 로직 구현(사용자 도메인 수정 및 데이터 베이스 변경)](V1%20_%20%E1%84%8C%E1%85%A5%E1%86%AB%E1%84%87%E1%85%A1%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%A8%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB%200cdf934c7d4a4c699cd0d135c8f88b90/%E1%84%87%E1%85%AE%E1%84%80%E1%85%A1%20%E1%84%85%E1%85%A9%E1%84%8C%E1%85%B5%E1%86%A8%20%E1%84%80%E1%85%AE%E1%84%92%E1%85%A7%E1%86%AB(%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%8C%E1%85%A1%20%E1%84%83%E1%85%A9%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%2013de1da7a16243779a9daf3039d89607.md)

Spring & JPA를 사용하여 개발시 우려 사항
- 기존 테이블을 jpa가 인식하여 쿼리를 실행하는 구조로 갈것인지
- 또는 JPA가 생성한 테이블을 활용하여

# 5. 프론트 개발_ V1

프론트 개발 간단하게 정리
React Redux Redux-Saga 환경 구축 완료
**[0908]**
admin페이지 유사 조건 >> 페이징 동작 수정 
액샐 파일 >> json형태로 변경하는 코드 필요
학생 수정 할 수 있는 UI개발 필요
**[0909]**
관리자 페이지 학생 등록 완료
관리자 수정 기능 완료
기능 개발 해야할 부분
* 학생 정보 수정 (단일 ,일괄)
* 현재 페이징이 고정되어 있는데 수정이 필요함
**[0910]**
관리자 페이지 학생 정보 수정 기능 완료
필요 기능 개발 완료 하여 배포 진행 완료

TypeScript 에러 정리

[TypeScript: Object.keys return string[]](https://stackoverflow.com/questions/52856496/typescript-object-keys-return-string)

[GitHub - kimamula/ts-transformer-keys: A TypeScript custom transformer which enables to obtain keys of given type](https://github.com/kimamula/ts-transformer-keys)

# 6. release 진행

React , React-Router 사용시 /multi >> /multi/find에서 refresh시도시 404 발생하는 문제 발생
문제를 해결하기 위해서 apache2 설정 파일을 수정해주어야한다.

[React앱 Apache로 배포 시 404 에러 해결하기](https://bohyeon-n.github.io/deploy/web/react_apache_error.html)

```xml
# site-available 수정 사항
<VirtualHost *:80>
<Directory "/var/www/html/multi">

          Options -MultiViews
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.html [QSA,L]

    Require all granted
</Directory>
</VirtualHost>
```

```bash
a2enmod rewrite
service apache2 restart
```

[Uncaught SyntaxError: Unexpected token '<'](https://akjfal.tistory.com/entry/Uncaught-SyntaxError-Unexpected-token)

script 로드 하는 과정에서 에러 발생 >> 포스팅과 같이 수정후 심볼릭 링크를 사용하여 해결

script를 적용하기 위해서 심볼릭 링크를 통해서 연결하여 진행하였다.
**SPA적용에 있어 부족했던 부분은 해결 하였다.**

# 7. 프론트 개발 V2 UI 수정

V1 참고 자료 정리_09_12마감