# 쉘 스크립트 정리

생성일: 2021년 9월 12일 오후 8:46

- 매개 변수
    - $0 실행시킨 스크립트 명
    - $1-$9 매개 변수
    - %@ 전달 받은 arguement 수
    - $? 실행 명령문의 result을 받아 온다. >> 종료 여부 확인
    - $$ 현 스크립트의 프로세스 ID 확인
- Global variable

기존에 존재하는 전역 변수

- $USER
- $HOSTNAME
- $RANDOM
- 값이나 문자 읽기
    - read var1
    - read -n3 var1
    - read -p "input data : " var1
    - read -s -n 2 -p "Name :" -s는 보안의 축약언어로 사용
- 문자열
    - if [[ $val =~ "문자열" ]]; 특정 문자열 포함 여부 확인

### 조건 (문자와 숫자를 비교하는 방법이 다르니 주의해서!!)

```bash
#!/bin/bash

read -n 10 -p "input Data :" var1
#var2="HELO"
if [ $var1 == "Hello" ]; then
	echo "if $var1 world"
elif [ $var1 == "world" ]; then
	echo "elif Hello $var1"
else 
	echo "else $var1"
fi

VAL1=3
VAL2=3
if [ ${VAL1} -eq ${VAL2} ] ; then
	echo "equal"
fi
STR1=""
STR2="A"
STR3="A"
# String이 존재하지 않으면 실행
if [[ -z $STR1 ]]; then
	echo "[[ -z STR1 ]] $STR1"
fi
# String이 존재하면 실행
if [ -n $STR2 ]; then
	echo "[[ -n STR1 ]] $STR2"
fi
# String이 동일하면 실행
if [ $STR2 == $STR3 ]; then
	echo "[[ $STR2 == $STR3 ]]"
fi
```

### 조건(파일 관련 조건 옵션)

```bash
#! /bin/bash
#: 현재 쉘 스크립트를 배우고 있습니다.
read -p "input file name : " file
echo "input file name $file"
# 파일 권한 확인 
if [ -r $file ]; then
    echo "File has read access"
else 
    echo "File does not have read access"
fi
# 파일 권한 확인 
if [ -w $file ]; then
    echo "File has write permission"
else
    echo "File does not have write permission"
fi
# 파일 권한 확인 
if [ -x $file ]; then
    echo "File has excute permission"
else 
    echo "File does not have excute permission"
fi
# 존재 여부 확인
if [ -e $file ]; then
    echo "File exist"
else 
    echo "File does not exist"
fi
#디렉토리 인지 확인
if [ -d $file ]; then
    echo "File is a directory"
else 
    echo "File is not a directory"
fi
```

## 반복문(for)

```bash
#! /bin/bash
# exec 실행에 있어 모든것을 처리할 수 있도록해준다.
# 0 표준 입력
# 1 표준 출력
# 2 표준 에러
# 뛰어쓰기 주의 할것
# exec 1>>
exec 2>> error.txt
# exec 1>> out.txt  하게 된다면 터미널에 나오는 문구들이 out.txt에 write되게 된다.
echo 'for val in {1..5}'
for val in {1..5}
do 
    echo "${val}"
done
echo 'for val in $(seq 5 10)'
for val in $(seq 5 10);
do 
    echo "$val"
done
count=0
for file in $@
do 
    if [ -f $file ]; then
        wc -l $file
    elif [ -d $file ]; then
        for subfile in $file/*
            do
                echo "sub file :" 
                wc -l $subfile 
            done
    fi
# 프로그래밍 언어처럼 숫자를 더하고 싶은경우 let을 통해 선언 필요 JavaScript ES5문법
let count=count+1
done
echo "Total count : $count"
```

## case 문

```bash
#! /bin/bash

case $1 in #swich()
    start) # case()
            echo "Straring"
            ;;
    stop) 
            echo "Stoppring"
            ;;
    *)
        echo "I don not know .."
        exit 1
        ;; #break;
esac
```

## 간단한 함수 선언 호출

```bash
#! /bin/bash

global=10

function foo(){
        local val=3
        echo "foo(){}"
        echo "global variable = $global"
        echo "local variable = $val"
        echo "arg1 = $1"
        echo "arg2 = $2"
}

foo arg1 arg2
```

```bash
#! /bin/bash
# $() 의미
# $(__)__명령어를 평가하게 되어 그에 관한 결과를 통해 여러 동작을 할 수 잇게 된다
for i in $(ls)
do
        echo item : $i
done

if [ -z $1 ]; then
        echo usage : $0 directory
        # exit 숫자 숫자를 입력함으로써 현 프로그램이 동작을 종료되고 다음 어떤 로직을 동작할 수 있게끔 제공할 수 있다.
        # echo $? 로 exit값을 확인할 수 있다.
        exit 1
fi
SRCD=$1
TGTD="./backup/"
OF=home-$(date +%Y%m%d).tar
tar -cvf $TGTD$OF $SRCE
```

## 배열 및 살짝 응용

```bash
#! /bin/bash
# {} &> {} 하게 되면 에러 발생시 추가적인 동작을 할 수 있게끔 제공

#쉘 스크립트에서의 배열
back_dirs=("./foo" "./pushDir1" "./pushDir2")
dest_dirt="./backup"
dest_server="server1"
backup_date=$(date +%b-%d-%y)

#[@]배열의 모든 요소를 의미한다.
# $@를 하게 되면 입력한 모든 인자값을 가져오는것을 생각하면 될거 같다.
echo "Staring backup of : ${back_dirs[@]}"

for i in ${back_dirs[@]}
do
        if [ ${back_dirs[1]} ==  $i ]; then
                exit 5
        fi
        tar -zczf ${dest_dirt}/$i-$dest_server.tar.gz $i
        if [ $? -eq 0 ]; then
                echo $i backup succeeded
        else 
                echo $i backup failed
        fi
done
```